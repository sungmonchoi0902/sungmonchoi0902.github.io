<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Meet myself through shout</title>

<style>
  body {
    margin: 0;
    padding: 40px 0;
    background: white;
    color: black;
    font-family: Arial, sans-serif;
    text-align: center;
  }
  .title {
    font-size: 28px;
    font-weight: bold;
  }
  .desc {
    margin-top: 10px;
    font-size: 14px;
    opacity: 0.8;
  }
  .line {
    width: 60%;
    margin: 25px auto;
    border-bottom: 1px solid #ddd;
  }
  #sketch {
    margin-top: 20px;
  }
</style>
</head>

<body>

<div class="title">Meet my self through shout</div>

<div class="desc">
  The emotions you’ve hidden, the voice you’ve been suppressing.<br>
  The moment the volume rises, your true self, once concealed, awakens.
</div>

<div class="line"></div>

<div id="sketch"></div>

<script>
let cam;
let mic;
let smoothVol = 0;
let bgOsc1, bgOsc2, bgOsc3;
let beepOsc;
let bgOn = true;
let beepOn = false;

let cleanMode = false; 
let cleanUntil = 0; 

function setup() {
  let c = createCanvas(640, 480);
  c.parent("sketch");
  pixelDensity(1);

  cam = createCapture(VIDEO);
  cam.size(320, 240);
  cam.hide();

  mic = new p5.AudioIn();
  mic.start();

  noStroke();
  rectMode(CORNER);
  frameRate(30);

  bgOsc1 = new p5.Oscillator('sine');
  bgOsc2 = new p5.Oscillator('sine');
  bgOsc3 = new p5.Oscillator('sine');

  bgOsc1.freq(130.81);
  bgOsc2.freq(293.66);
  bgOsc3.freq(493.88);

  bgOsc1.amp(0.03);
  bgOsc2.amp(0.025);
  bgOsc3.amp(0.02);

  bgOsc1.start();
  bgOsc2.start();
  bgOsc3.start();

  beepOsc = new p5.Oscillator('sine');
  beepOsc.freq(880);
  beepOsc.amp(0);
  beepOsc.start();
}

function draw() {
  background(0);

  let vol = mic.getLevel();
  smoothVol = lerp(smoothVol, vol, 0.1);

  let mosaicSize = int(map(smoothVol, 0, 0.05, 60, 1, true));

  cam.loadPixels();
  if (cam.pixels.length === 0) return;

  if (millis() < cleanUntil) {
    cleanMode = true;
  } else {
    cleanMode = (mosaicSize <= 2);
  }

  if (cleanMode && millis() >= cleanUntil) {
    cleanUntil = millis() + 3000; 
  }

  push();
  translate(width, 0);
  scale(-1, 1);

  if (!cleanMode) {
    for (let y = 0; y < cam.height; y += mosaicSize) {
      for (let x = 0; x < cam.width; x += mosaicSize) {
        let i = (y * cam.width + x) * 4;
        fill(cam.pixels[i], cam.pixels[i+1], cam.pixels[i+2]);
        rect(x * 2, y * 2, mosaicSize * 2, mosaicSize * 2);
      }
    }

    if (beepOn) {
      beepOsc.amp(0, 0.3);
      beepOn = false;
    }
    if (!bgOn) {
      bgOsc1.amp(0.03, 0.5);
      bgOsc2.amp(0.025, 0.5);
      bgOsc3.amp(0.02, 0.5);
      bgOn = true;
    }

  } else {
    image(cam, 0, 0, width, height);

    if (!beepOn) {
      beepOsc.amp(0.2, 0.2);
      beepOn = true;
    }
    if (bgOn) {
      bgOsc1.amp(0, 0.5);
      bgOsc2.amp(0, 0.5);
      bgOsc3.amp(0, 0.5);
      bgOn = false;
    }
  }

  pop();
}
</script>

</body>
</html>